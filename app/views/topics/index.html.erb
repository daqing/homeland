<% if action_name != "index" %>
  <% title_tag(@page_title || t('menu.topics')) %>
<% end %>
<!-- @suggest_topics maybe nil or ActiveRecord::Relation, but we need an array -->
<% @suggest_topics = @suggest_topics.to_a %>
<%= render "topics/node_info", node: @node %>
<div class="flex flex-col gap-4 lg:flex-row">
  <div class="grow lg:w-3/4">
    <div class="topics topics-<%= action_name %> card">
      <div class="container px-3 lg:px-0" style="border-bottom: 1px solid var(--topic-item-border-color);">
        <ul class="nav nav-pills flex gap-4 py-2">
          <li class="<%= ' active' if action_name == 'index' %>">
            <a href="<%= main_app.topics_path %>" data-turbolinks-action="replace" class="text-zinc-500 hover:text-orange-500"><%= t("topics.topic_list.latest") %></a>
          </li>
          <li class="<%= ' active' if action_name == 'last' %>">
            <%= link_to(t("topics.topic_list.recent"), main_app.last_topics_path, class: 'text-zinc-500 hover:text-orange-500', data: { 'turbolinks-action': 'replace' }) %>
          </li>
          <li class="<%= ' active' if action_name == 'excellent' %>">
            <a href="<%= main_app.excellent_topics_path %>" data-turbolinks-action="replace" class="text-zinc-500 hover:text-orange-500"><i class="fa fa-award"></i> <%= t("topics.topic_list.excellent") %></a>
          </li>
          <li class="<%= ' active' if action_name == 'popular' %>">
            <a href="<%= main_app.popular_topics_path %>" data-turbolinks-action="replace" class="text-zinc-500 hover:text-orange-500"><%= t("topics.topic_list.popular") %></a>
          </li>
          <% if can?(:ban, Topic) %>
            <li class="<%= ' active' if action_name == 'banned' %>">
              <%= link_to(t("topics.topic_list.banned"), main_app.banned_topics_path, class: 'text-zinc-500 hover:text-orange-500', data: { 'turbolinks-action': 'replace' }) %>
            </li>
          <% end %>
          <% if !mobile? %>
            <li class="<%= ' active' if action_name == 'last_reply' %>">
              <%= link_to(t("topics.topic_list.last_reply"), main_app.last_reply_topics_path, class: 'text-zinc-500 hover:text-orange-500', data: { 'turbolinks-action': 'replace' }) %>
            </li>
          <% end %>
        </ul>
      </div>
      <div class="card-body item-list">
        <% if @suggest_topics.present? %>
          <%= render TopicComponent.with_collection(@suggest_topics, type: "suggest") %>
        <% end %>
        <%= render TopicComponent.with_collection(@topics) %>
      </div>
      <% if  @topics.total_pages > 1 %>
        <div class="clearfix card-footer">
          <% if (action_name.in? %(index recent)) && (controller_name == "topics") %>
            <%= paginate @topics, total_pages: Topic.total_pages %>
          <% else %>
            <%= paginate @topics %>
          <% end %>
        </div>
      <% end %>
    </div>
    <% if current_user %>
      <script type="text/javascript">
        var readed_topic_ids = <%= @read_topic_ids || [] %>;
        for (var i = 0; i < readed_topic_ids.length; i++) {
          topic_id = readed_topic_ids[i];
          $(".topic-"+ topic_id).addClass('topic-visited');
          $(".topic-"+ topic_id + " .count a").addClass("state-true");
        }
      </script>
    <% end %>
  </div>
  <div class="w-full lg:w-1/4">
    <%= render "topics/sidebar_for_topic_index" %>
  </div>
</div>
